// Generated by CoffeeScript 1.3.3
(function() {

  window.CurrentLocation = (function() {

    function CurrentLocation() {
      this.latLng = null;
      this.geolocation = navigator.geolocation;
      this.watchId = null;
    }

    CurrentLocation.prototype.getErrorMessage = function(code) {
      switch (code) {
        case -1:
          return "SUCCESS";
        case 0:
          return "Sorry, there was an unknown error.";
        case 1:
          return "Hey, we need permission to give you directions.";
        case 2:
          return "Sorry, your position is unavailable.";
        case 3:
          return "Sorry, we couldn't find your location in time.";
        case 4:
          return "Sorry, this device doesn't support location.";
        default:
          return code;
      }
    };

    CurrentLocation.prototype.updatePosition = function(latLngArray) {
      return this.latLng = latLngArray && latLngArray.length === 2 ? latLngArray : null;
    };

    CurrentLocation.prototype.stopWatching = function() {
      if (this.watchId) {
        return this.geolocation.clearWatch(this.watchId);
      }
    };

    CurrentLocation.prototype.watchPosition = function(callback) {
      var gotPosition, unknownPosition,
        _this = this;
      gotPosition = function(location) {
        var lat, latLngArray, lng;
        lat = location.coords.latitude;
        lng = location.coords.longitude;
        latLngArray = [lat, lng];
        _this.updatePosition(latLngArray);
        if (callback != null) {
          return callback(latLngArray, _this.getErrorMessage(-1));
        }
      };
      unknownPosition = function(positionError) {
        return callback(null, _this.getErrorMessage(positionError.code));
      };
      if (this.geolocation) {
        return this.watchId = this.geolocation.watchPosition(gotPosition, unknownPosition, {
          enableHighAccuracy: true,
          maximumAge: 30000,
          timeout: 27000
        });
      } else {
        return callback(null, this.getErrorMessage(4));
      }
    };

    CurrentLocation.prototype.getPosition = function(callback) {
      var gotPosition, unknownPosition,
        _this = this;
      gotPosition = function(location) {
        var lat, latLngArray, lng;
        lat = location.coords.latitude;
        lng = location.coords.longitude;
        latLngArray = [lat, lng];
        _this.updatePosition(latLngArray);
        if (callback != null) {
          return callback(latLngArray, _this.getErrorMessage(-1));
        }
      };
      unknownPosition = function(positionError) {
        return callback(null, _this.getErrorMessage(positionError.code));
      };
      if (this.geolocation) {
        return this.geolocation.getCurrentPosition(gotPosition, unknownPosition);
      } else {
        return callback(null, this.getErrorMessage(4));
      }
    };

    return CurrentLocation;

  })();

}).call(this);
